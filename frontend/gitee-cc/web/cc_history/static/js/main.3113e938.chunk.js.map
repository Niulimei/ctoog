{"version":3,"sources":["request/index.js","lib/constants.js","page/index.js","store/redcer.js","store/index.js","index.js"],"names":["get","url","params","Promise","resolve","reject","axios","then","res","data","catch","err","message","error","SAVE_HISTORY","SAVE_OPTION","TableConfig","Input","Search","bordered","size","expandable","expandedRowRender","record","className","dangerouslySetInnerHTML","__html","description","title","undefined","showHeader","hasData","tableLayout","top","bottom","Page","useState","expandKeys","setExpandKeys","tableLoading","setTableLoading","currentPage","setCurrentPage","useSelector","state","historyDataSource","total","options","dispatch","useDispatch","columns","useMemo","key","dataIndex","codeId","useParams","getData","useCallback","value","payloadParams","git_name","limit","offset","id","type","payload","useEffect","onSearch","keyWordChange","e","inputKeyWord","target","map","label","handleTableExpand","expanded","newExpandKeys","push","dropdownClassName","style","width","margin","onSelect","placeholder","enterButton","onChange","loading","expandedRowKeys","pagination","position","current","showSizeChanger","defaultState","defaultReducer","action","infoItem","count","store","createStore","redcer","window","__REDUX_DEVTOOLS_EXTENSION__","ReactDOM","render","path","component","document","getElementById"],"mappings":"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","file":"static/js/main.3113e938.chunk.js","sourcesContent":["import axios from \"axios\";\r\nimport { message } from 'antd';\r\n\r\nexport function request(config, data, success, fail) {\r\n    axios({\r\n        // 暂时决定后期接口出来将url写死，通过参数获取数据\r\n        url: config,\r\n        params: data\r\n    }).then(\r\n        res => { success(res) }\r\n    ).catch(\r\n        err => { fail(err) }\r\n    )\r\n};\r\n\r\n// get请求\r\nexport function get(url, params) {\r\n    return new Promise((resolve, reject) => {\r\n        axios.get(url, {\r\n            params: params\r\n        }).then(res => {\r\n            resolve(res.data)\r\n        }).catch(err => {\r\n            reject(err.data)\r\n            message.error(err.message)\r\n        })\r\n    })\r\n};\r\n\r\n// post请求\r\nexport function post(url, params) {\r\n    return new Promise((resolve, reject) => {\r\n        axios.post(url, params).then(res => {\r\n            resolve(res.data);\r\n            console.log(\"post---\", res);\r\n        }).catch(err => {\r\n            reject(err.data);\r\n            console.log(\"post---\", err);\r\n        })\r\n    })\r\n};\r\n\r\n// 删除\r\nexport function deleteFn(url, params) {\r\n    return new Promise((resolve, reject) => {\r\n        axios.delete(url, params).then(res => {\r\n            resolve(res.data);\r\n            console.log(\"del---\", res);\r\n        }).catch(err => {\r\n            reject(err.data)\r\n            console.log(\"del---\", err);\r\n        })\r\n    })\r\n};\r\n\r\n// 更新\r\nexport function put(url, params) {\r\n    return new Promise((resolve, reject) => {\r\n        axios.put(url, params)\r\n            .then(res => {\r\n                resolve(res.data);\r\n                console.log(\"put---\", res);\r\n            })\r\n            .catch(err => {\r\n                reject(err.data)\r\n                console.log(\"put---\", err);\r\n            })\r\n    });\r\n};\r\n\r\n// 更新局部资源\r\nexport function patch(url, params = {}) {\r\n    return new Promise((resolve, reject) => {\r\n        axios.patch(url, params).then(res => {\r\n            resolve(res.data)\r\n            console.log(\"patch---\", res);\r\n        }).catch(err => {\r\n            reject(err)\r\n            console.log(\"patch---\", err);\r\n        })\r\n    })\r\n}\r\n\r\n","// 保存数据action type\r\nexport const SAVE_HISTORY = 'SAVE_HISTORY';\r\n// 保存option\r\nexport const SAVE_OPTION = 'SAVE_OPTION'\r\n","import React, { useCallback, useEffect, useState, useMemo } from 'react';\r\nimport { PageHeader, Input, Space, Table, AutoComplete } from 'antd';\r\nimport { useSelector, useDispatch } from 'react-redux'\r\nimport { get } from '../request/index'\r\nimport './index.css';\r\nimport { SAVE_HISTORY, SAVE_OPTION } from '../lib/constants';\r\nimport { useParams } from 'react-router-dom';\r\n\r\nconst { Search } = Input;\r\n\r\n// 表格的一些固定配置\r\nconst TableConfig = {\r\n  bordered: false, //是否展示外边框和列边框\r\n  size: 'default',\r\n  expandable: {\r\n    expandedRowRender: record => (\r\n      <p\r\n        className=\"pSty\"\r\n        dangerouslySetInnerHTML={{ __html: record.description }}\r\n      />\r\n    )\r\n  }, //配置展开属性\r\n  title: undefined,//表格标题\r\n  showHeader: true,      //是否显示表头\r\n  hasData: true,\r\n  tableLayout: undefined,//表格元素的 table-layout 属性\r\n  top: \"10%\",\r\n  bottom: 'bottomRight',\r\n}\r\n\r\nconst Page = () => {\r\n  // 表格的行选中\r\n  const [expandKeys, setExpandKeys] = useState([]);\r\n\r\n  // 表格的加载状态\r\n  const [tableLoading, setTableLoading] = useState(true);\r\n\r\n  // 当前分页数\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n\r\n  // 当前关键词\r\n  const [keyword, setKeyword] = useState([]);\r\n\r\n  // 从redux中取数据\r\n  const { historyDataSource, total,options } = useSelector(state => state);\r\n\r\n  const dispatch = useDispatch();\r\n\r\n  const columns = useMemo(() => ([\r\n    {\r\n      title: '名称',\r\n      key: 'name',\r\n      dataIndex: 'name'\r\n    },\r\n    {\r\n      title: '所有人',\r\n      key: 'owner',\r\n      dataIndex: 'owner'\r\n    },\r\n    {\r\n      title: '创建时间',\r\n      key: 'createTime',\r\n      dataIndex: 'createTime'\r\n    },\r\n    {\r\n      title: 'ID',\r\n      key: 'id',\r\n      dataIndex: 'id'\r\n    }, {\r\n      title: '活动状态',\r\n      key: 'historyType',\r\n      dataIndex: 'historyType'\r\n    }\r\n  ]), [])\r\n\r\n  // 取出参数中的ID\r\n  const { codeId } = useParams();\r\n\r\n  // 获取后端数据方法\r\n  const getData = useCallback(value => {\r\n    setTableLoading(true);\r\n\r\n    const payloadParams = {\r\n      git_name: codeId,\r\n      limit: 10,\r\n      offset: 10 * (currentPage - 1),\r\n    }\r\n\r\n    if (value) {\r\n      payloadParams.id = value;\r\n      payloadParams.offset = 0;\r\n    }\r\n\r\n    get('/gitee-cc/cc_history', payloadParams)\r\n      .then((res) => {\r\n        // 请求最新数据成功清除之前的展开状态\r\n        setExpandKeys([]);\r\n\r\n        setTableLoading(false);\r\n\r\n        dispatch({\r\n          type: SAVE_HISTORY,\r\n          payload: res\r\n        })\r\n      })\r\n      .catch(() => {\r\n        setTableLoading(false);\r\n      })\r\n  }, [codeId, currentPage]); // eslint-disable-line\r\n\r\n  // 初始化加载完成请求数据\r\n  useEffect(getData, [getData])\r\n\r\n  // 回车查询\r\n  const onSearch = useCallback((value) => {\r\n    getData(value);\r\n  }, [getData])\r\n\r\n  // 键入事件监听\r\n  const keyWordChange = useCallback((e) => {\r\n    let inputKeyWord = e.target.value\r\n    if(inputKeyWord != ''){\r\n      const payloadParams = {\r\n        git_name: codeId,\r\n        limit: 5,\r\n        offset: 0,\r\n        id:inputKeyWord\r\n      }\r\n      get('/gitee-cc/cc_history_search',payloadParams).then((res)=>{\r\n        dispatch({\r\n          type: SAVE_OPTION,\r\n          payload: res?.map((id) => ({\r\n            label: id,\r\n            value: id\r\n          }))\r\n        })\r\n      })\r\n    }\r\n    \r\n  },[])\r\n\r\n  // 点击选中展开符号逻辑\r\n  const handleTableExpand = useCallback((expanded, record) => {\r\n    let newExpandKeys = []\r\n    if (expanded) {\r\n      newExpandKeys.push(record.id)\r\n    }\r\n    setExpandKeys(newExpandKeys)\r\n  }, []);\r\n\r\n  return (\r\n    <div>\r\n      <PageHeader\r\n        className=\"site-page-header\"\r\n        title=\"已归档历史记录\"\r\n      />\r\n      \r\n        <AutoComplete\r\n        dropdownClassName=\"dropdownSty\"\r\n        style={{ width:'400px', margin: '0 0 0 24px' }}\r\n        options={options}\r\n        onSelect={onSearch}\r\n      >\r\n        <Input.Search size=\"large\" placeholder=\"请输入ID进行检索\" enterButton onChange={keyWordChange} onSearch={onSearch}/>\r\n      </AutoComplete>\r\n      \r\n      <Table\r\n        {...TableConfig}\r\n        loading={tableLoading}\r\n        expandedRowKeys={expandKeys}\r\n        pagination={{ position: [TableConfig.top, TableConfig.bottom] }}\r\n        columns={columns}\r\n        pagination={{\r\n          total,\r\n          position: 'bottom',\r\n          current: currentPage,\r\n          showSizeChanger: false,\r\n          onChange: setCurrentPage\r\n        }}\r\n        dataSource={historyDataSource}\r\n        rowExpandable={record => record.description ? 'Not Expandable' : ''}\r\n        style={{ margin: '20px 0 0 0' }}\r\n        rowKey={record => record.id}\r\n        onExpand={handleTableExpand}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Page;\r\n","import { SAVE_HISTORY, SAVE_OPTION } from \"../lib/constants\";\r\n\r\nconst defaultState = {\r\n    historyDataSource: [],\r\n    total: 0,\r\n    options:[],\r\n};\r\n\r\nfunction defaultReducer(state = defaultState, action) {\r\n    const { type, payload } = action;\r\n\r\n    switch (type) {\r\n        case SAVE_HISTORY:\r\n            const {\r\n                infoItem: historyDataSource,\r\n                count: total = 0,\r\n            } = payload;\r\n            return {\r\n                ...state,\r\n                historyDataSource,\r\n                total\r\n            }\r\n        case SAVE_OPTION: \r\n            return {\r\n                ...state,\r\n                options: payload\r\n            }\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\nexport default defaultReducer;\r\n","import { createStore } from \"redux\";\r\nimport redcer from \"./redcer\";\r\n\r\n\r\nconst store = createStore(\r\n    redcer,\r\n    window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()\r\n);\r\n\r\nexport default store;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport Page from './page';\r\nimport { HashRouter as Router, Route, Redirect } from 'react-router-dom'\r\nimport { Provider } from 'react-redux';\r\nimport store from './store';\r\n\r\nReactDOM.render(\r\n  <Router>\r\n    <Provider store={store}>\r\n      <Route path=\"/:codeId\" component={Page} />\r\n    </Provider>\r\n  </Router>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}